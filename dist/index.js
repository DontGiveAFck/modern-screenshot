var Jt=Object.defineProperty,Kt=Object.defineProperties;var Qt=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var Me=Math.pow,$e=(h,C,T)=>C in h?Jt(h,C,{enumerable:!0,configurable:!0,writable:!0,value:T}):h[C]=T,R=(h,C)=>{for(var T in C||(C={}))Be.call(C,T)&&$e(h,T,C[T]);if(Z)for(var T of Z(C))Le.call(C,T)&&$e(h,T,C[T]);return h},L=(h,C)=>Kt(h,Qt(C));var Oe=(h,C)=>{var T={};for(var A in h)Be.call(h,A)&&C.indexOf(A)<0&&(T[A]=h[A]);if(h!=null&&Z)for(var A of Z(h))C.indexOf(A)<0&&Le.call(h,A)&&(T[A]=h[A]);return T};var E=(h,C,T)=>new Promise((A,M)=>{var H=D=>{try{W(T.next(D))}catch(j){M(j)}},O=D=>{try{W(T.throw(D))}catch(j){M(j)}},W=D=>D.done?A(D.value):Promise.resolve(D.value).then(H,O);W((T=T.apply(h,C)).next())});(function(h,C){typeof exports=="object"&&typeof module!="undefined"?C(exports):typeof define=="function"&&define.amd?define(["exports"],C):(h=typeof globalThis!="undefined"?globalThis:h||self,C(h.modernScreenshot={}))})(this,function(h){var Ue;"use strict";function C(e,t){return e[13]=1,e[14]=t>>8,e[15]=t&255,e[16]=t>>8,e[17]=t&255,e}const T="p".charCodeAt(0),A="H".charCodeAt(0),M="Y".charCodeAt(0),H="s".charCodeAt(0);let O;function W(){const e=new Int32Array(256);for(let t=0;t<256;t++){let n=t;for(let r=0;r<8;r++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e}function D(e){let t=-1;O||(O=W());for(let n=0;n<e.length;n++)t=O[(t^e[n])&255]^t>>>8;return t^-1}function j(e){const t=e.length-1;for(let n=t;n>=4;n--)if(e[n-4]===9&&e[n-3]===T&&e[n-2]===A&&e[n-1]===M&&e[n]===H)return n-3;return 0}function ae(e,t,n=!1){const r=new Uint8Array(13);t*=39.3701,r[0]=T,r[1]=A,r[2]=M,r[3]=H,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=t&255,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;const a=D(r),i=new Uint8Array(4);if(i[0]=a>>>24,i[1]=a>>>16,i[2]=a>>>8,i[3]=a&255,n){const o=j(e);return e.set(r,o),e.set(i,o+13),e}else{const o=new Uint8Array(4);o[0]=0,o[1]=0,o[2]=0,o[3]=9;const s=new Uint8Array(54);return s.set(e,0),s.set(o,33),s.set(r,37),s.set(i,50),s}}const We="AAlwSFlz",je="AAAJcEhZ",qe="AAAACXBI";function Ve(e){let t=e.indexOf(We);return t===-1&&(t=e.indexOf(je)),t===-1&&(t=e.indexOf(qe)),t}const ee="[modern-screenshot]",U=typeof window!="undefined",He=U&&"Worker"in window,ie=U&&"atob"in window,ze=U&&"btoa"in window,te=U?(Ue=window.navigator)==null?void 0:Ue.userAgent:"",se=te.includes("Chrome"),z=te.includes("AppleWebKit")&&!se,ne=te.includes("Firefox"),Xe=e=>e&&"__CONTEXT__"in e,Ge=e=>e.constructor.name==="CSSFontFaceRule",Ye=e=>e.constructor.name==="CSSImportRule",k=e=>e.nodeType===1,q=e=>typeof e.className=="object",ce=e=>e.tagName==="image",Je=e=>e.tagName==="use",re=e=>k(e)&&typeof e.style!="undefined"&&!q(e),Ke=e=>e.nodeType===8,Qe=e=>e.nodeType===3,P=e=>e.tagName==="IMG",X=e=>e.tagName==="VIDEO",Ze=e=>e.tagName==="CANVAS",le=e=>e.tagName==="TEXTAREA",et=e=>e.tagName==="INPUT",tt=e=>e.tagName==="STYLE",nt=e=>e.tagName==="SCRIPT",rt=e=>e.tagName==="SELECT",ot=e=>e.tagName==="SLOT",at=e=>e.tagName==="IFRAME",v=(...e)=>console.warn(ee,...e),it=e=>console.time(`${ee} ${e}`),st=e=>console.timeEnd(`${ee} ${e}`),ct=e=>{var n;const t=(n=e==null?void 0:e.createElement)==null?void 0:n.call(e,"canvas");return t&&(t.height=t.width=1),t&&"toDataURL"in t&&!!t.toDataURL("image/webp").includes("image/webp")},oe=e=>e.startsWith("data:");function ue(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(U&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!U)return e;const n=G().implementation.createHTMLDocument(),r=n.createElement("base"),a=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(a),t&&(r.href=t),a.href=e,a.href}function G(e){var t;return(t=e&&k(e)?e==null?void 0:e.ownerDocument:e)!=null?t:window.document}const Y="http://www.w3.org/2000/svg";function fe(e,t,n){const r=G(n).createElementNS(Y,"svg");return r.setAttributeNS(null,"width",e.toString()),r.setAttributeNS(null,"height",t.toString()),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${t}`),r}function de(e,t){let n=new XMLSerializer().serializeToString(e);return t&&(n=n.replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/ug,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(n)}`}function lt(e,t="image/png",n=1){return E(this,null,function*(){try{return yield new Promise((r,a)=>{e.toBlob(i=>{i?r(i):a(new Error("Blob is null"))},t,n)})}catch(r){if(ie)return v("Failed canvas to blob",{type:t,quality:n},r),ut(e.toDataURL(t,n));throw r}})}function ut(e){var s,c;const[t,n]=e.split(","),r=(c=(s=t.match(/data:(.+);/))==null?void 0:s[1])!=null?c:void 0,a=window.atob(n),i=a.length,o=new Uint8Array(i);for(let u=0;u<i;u+=1)o[u]=a.charCodeAt(u);return new Blob([o],{type:r})}function me(e,t){return new Promise((n,r)=>{const a=new FileReader;a.onload=()=>n(a.result),a.onerror=()=>r(a.error),a.onabort=()=>r(new Error(`Failed read blob to ${t}`)),t==="dataUrl"?a.readAsDataURL(e):t==="arrayBuffer"&&a.readAsArrayBuffer(e)})}const ft=e=>me(e,"dataUrl"),dt=e=>me(e,"arrayBuffer");function _(e,t){const n=G(t).createElement("img");return n.decoding="sync",n.loading="eager",n.src=e,n}function $(e,t){return new Promise(n=>{const{timeout:r,ownerDocument:a,onError:i}=t!=null?t:{},o=typeof e=="string"?_(e,G(a)):e;let s=null,c=null;function u(){n(o),s&&clearTimeout(s),c==null||c()}if(r&&(s=setTimeout(u,r)),X(o)){const l=o.currentSrc||o.src;if(!l)return o.poster?$(o.poster,t).then(n):u();if(o.readyState>=2)return u();const f=u,d=m=>{v("Failed video load",l,m),i==null||i(m),u()};c=()=>{o.removeEventListener("loadeddata",f),o.removeEventListener("error",d)},o.addEventListener("loadeddata",f,{once:!0}),o.addEventListener("error",d,{once:!0})}else{const l=ce(o)?o.href.baseVal:o.currentSrc||o.src;if(!l)return u();const f=()=>E(this,null,function*(){if(P(o)&&"decode"in o)try{yield o.decode()}catch(m){v("Failed to decode image, trying to render anyway",o.dataset.originalSrc||l,m)}u()}),d=m=>{v("Failed image load",o.dataset.originalSrc||l,m),u()};if(P(o)&&o.complete)return f();c=()=>{o.removeEventListener("load",f),o.removeEventListener("error",d)},o.addEventListener("load",f,{once:!0}),o.addEventListener("error",d,{once:!0})}})}function ge(e,t){return E(this,null,function*(){re(e)&&(P(e)||X(e)?yield $(e,{timeout:t}):yield Promise.all(["img","video"].flatMap(n=>Array.from(e.querySelectorAll(n)).map(r=>$(r,{timeout:t})))))})}const he=function(){let t=0;const n=()=>`0000${(Math.random()*Me(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)}();function we(e){return e==null?void 0:e.split(",").map(t=>t.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}function mt(e){return{time:t=>e&&it(t),timeEnd:t=>e&&st(t),warn:(...t)=>e&&v(...t)}}function gt(e){return{cache:e?"no-cache":"force-cache"}}function x(e,t){return E(this,null,function*(){return Xe(e)?e:pe(e,L(R({},t),{autoDestruct:!0}))})}function pe(e,t){return E(this,null,function*(){var m,g,y,b,w;const{scale:n=1,workerUrl:r,workerNumber:a=1}=t||{},i=!!(t!=null&&t.debug),o=(m=t==null?void 0:t.features)!=null?m:!0,s=(g=e.ownerDocument)!=null?g:U?window.document:void 0,c=(b=(y=e.ownerDocument)==null?void 0:y.defaultView)!=null?b:U?window:void 0,u=new Map,l=L(R({width:0,height:0,quality:1,type:"image/png",scale:n,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:i,fetch:R({requestInit:gt((w=t==null?void 0:t.fetch)==null?void 0:w.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1},t==null?void 0:t.fetch),font:{},drawImageInterval:100,workerUrl:null,workerNumber:a,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,autoDestruct:!1},t),{__CONTEXT__:!0,log:mt(i),node:e,ownerDocument:s,ownerWindow:c,dpi:n===1?null:96*n,svgStyleElement:ye(s),svgDefsElement:s==null?void 0:s.createElementNS(Y,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...new Array(He&&r&&a?a:0)].map(()=>{try{const S=new Worker(r);return S.onmessage=p=>E(this,null,function*(){var F,_e,Q,Pe;const{url:N,result:I}=p.data;I?(_e=(F=u.get(N))==null?void 0:F.resolve)==null||_e.call(F,I):(Pe=(Q=u.get(N))==null?void 0:Q.reject)==null||Pe.call(Q,new Error(`Error receiving message from worker: ${N}`))}),S.onmessageerror=p=>{var I,F;const{url:N}=p.data;(F=(I=u.get(N))==null?void 0:I.reject)==null||F.call(I,new Error(`Error receiving message from worker: ${N}`))},S}catch(S){return v("Failed to new Worker",S),null}}).filter(Boolean),fontFamilies:new Set,fontCssTexts:new Map,acceptOfImage:`${[ct(s)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:u,drawImageCount:0,tasks:[],features:o,isEnable:S=>{var p;return typeof o=="boolean"?o:(p=o[S])!=null?p:!0}});l.log.time("wait until load"),yield ge(e,l.timeout),l.log.timeEnd("wait until load");const{width:f,height:d}=ht(e,l);return l.width=f,l.height=d,l})}function ye(e){if(!e)return;const t=e.createElement("style"),n=t.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return t.appendChild(n),t}function ht(e,t){let{width:n,height:r}=t;if(k(e)&&(!n||!r)){const a=e.getBoundingClientRect();n=n||a.width||Number(e.getAttribute("width"))||0,r=r||a.height||Number(e.getAttribute("height"))||0}return{width:n,height:r}}function wt(e,t){return E(this,null,function*(){const{log:n,timeout:r,drawImageCount:a,drawImageInterval:i}=t;n.time("image to canvas");const o=yield $(e,{timeout:r}),{canvas:s,context2d:c}=pt(e.ownerDocument,t),u=()=>{try{c==null||c.drawImage(o,0,0,s.width,s.height)}catch(l){v("Failed to drawImage",l)}};if(u(),t.isEnable("fixSvgXmlDecode"))for(let l=0;l<a;l++)yield new Promise(f=>{setTimeout(()=>{u(),f()},l+i)});return t.drawImageCount=0,n.timeEnd("image to canvas"),s})}function pt(e,t){const{width:n,height:r,scale:a,backgroundColor:i,maximumCanvasSize:o}=t,s=e.createElement("canvas");s.width=Math.floor(n*a),s.height=Math.floor(r*a),s.style.width=`${n}px`,s.style.height=`${r}px`,o&&(s.width>o||s.height>o)&&(s.width>o&&s.height>o?s.width>s.height?(s.height*=o/s.width,s.width=o):(s.width*=o/s.height,s.height=o):s.width>o?(s.height*=o/s.width,s.width=o):(s.width*=o/s.height,s.height=o));const c=s.getContext("2d");return c&&i&&(c.fillStyle=i,c.fillRect(0,0,s.width,s.height)),{canvas:s,context2d:c}}const yt=["width","height"],bt=["stroke","fill"];function be(e,t,n){var b;const{defaultComputedStyles:r,ownerDocument:a}=n,i=e.nodeName.toLowerCase(),o=q(e)&&i!=="svg",s=o?bt.map(w=>[w,e.getAttribute(w)]).filter(([,w])=>w!==null):[],c=[o&&"svg",i,s.map((w,S)=>`${w}=${S}`).join(","),t].filter(Boolean).join(":");if(r.has(c))return r.get(c);let u=n.sandbox;if(!u)try{a&&(u=a.createElement("iframe"),u.id=`__SANDBOX__-${he()}`,u.width="0",u.height="0",u.style.visibility="hidden",u.style.position="fixed",a.body.appendChild(u),(b=u.contentWindow)==null||b.document.write('<!DOCTYPE html><meta charset="UTF-8"><title></title><body>'),n.sandbox=u)}catch(w){v("Failed to create iframe sandbox",w)}if(!u)return new Map;const l=u.contentWindow;if(!l)return new Map;const f=l.document;let d,m;o?(d=f.createElementNS(Y,"svg"),m=d.ownerDocument.createElementNS(d.namespaceURI,i),s.forEach(([w,S])=>{m.setAttributeNS(null,w,S)}),d.appendChild(m)):d=m=f.createElement(i),m.textContent=" ",f.body.appendChild(d);const g=l.getComputedStyle(m,t),y=new Map;for(let w=g.length,S=0;S<w;S++){const p=g.item(S);yt.includes(p)||y.set(p,g.getPropertyValue(p))}return f.body.removeChild(d),r.set(c,y),y}function Se(e,t){var i;const n=new Map,r=[],a=new Map;for(let o=e.length,s=0;s<o;s++){const c=e.item(s),u=e.getPropertyValue(c),l=e.getPropertyPriority(c),f=c.lastIndexOf("-"),d=f>-1?c.substring(0,f):void 0;if(d){let m=a.get(d);m||(m=new Map,a.set(d,m)),m.set(c,[u,l])}t.get(c)===u&&!l||(d?r.push(d):n.set(c,[u,l]))}for(let o=r.length,s=0;s<o;s++)(i=a.get(r[s]))==null||i.forEach((c,u)=>n.set(u,c));return n}const St=[":before",":after"],Et=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function Ct(e,t,n,r){const{ownerWindow:a,svgStyleElement:i,svgStyles:o}=r;if(!i||!a)return;function s(c){var w;const u=a.getComputedStyle(e,c);let l=u.getPropertyValue("content");if(!l||l==="none")return;l=l.replace(/(')|(")|(counter\(.+\))/g,"");const f=[he()],d=be(e,c,r),m=[`content: '${l}';`],g=Se(u,d);if(g.delete("content"),g.delete("-webkit-locale"),((w=g.get("background-clip"))==null?void 0:w[0])==="text"&&t.classList.add("______background-clip--text"),g.forEach(([S,p],N)=>{m.push(`${N}: ${S}${p?" !important":""};`)}),m.length===1)return;try{t.className=[t.className,...f].join(" ")}catch(S){return}const y=m.join(`
  `);let b=o.get(y);b||(b=[],o.set(y,b)),b.push(`.${f[0]}:${c}`)}St.forEach(s),n&&Et.forEach(s)}function Tt(e,t){le(e)&&(t.innerHTML=e.value),(le(e)||et(e)||rt(e))&&t.setAttribute("value",e.value)}function vt(e,t,n,r){var u,l,f,d;const{ownerWindow:a}=r,i=t.style,o=a.getComputedStyle(e),s=be(e,null,r),c=Se(o,s);return c.delete("transition-property"),c.delete("all"),c.delete("d"),c.delete("content"),n&&(c.delete("margin-top"),c.delete("margin-right"),c.delete("margin-bottom"),c.delete("margin-left"),c.delete("margin-block-start"),c.delete("margin-block-end"),c.delete("margin-inline-start"),c.delete("margin-inline-end"),c.set("box-sizing",["border-box",""])),((u=c.get("background-clip"))==null?void 0:u[0])==="text"&&(t.classList.add("______background-clip--text"),i.removeProperty("background")),se&&(c.has("font-kerning")||c.set("font-kerning",["normal",""]),(((l=c.get("overflow-x"))==null?void 0:l[0])==="hidden"||((f=c.get("overflow-y"))==null?void 0:f[0])==="hidden")&&((d=c.get("text-overflow"))==null?void 0:d[0])==="ellipsis"&&e.scrollWidth===e.clientWidth&&c.set("text-overflow",["clip",""])),c.forEach(([m,g],y)=>{i.setProperty(y,m,g)}),c}function At(e,t){var n;try{if((n=e==null?void 0:e.contentDocument)!=null&&n.body)return J(e.contentDocument.body,t)}catch(r){v("Failed to clone iframe",r)}return e.cloneNode(!1)}function Ee(e){if(e.ownerDocument)try{const a=e.toDataURL();if(a!=="data:,")return _(a,e.ownerDocument)}catch(a){}const t=e.cloneNode(!1),n=e.getContext("2d"),r=t.getContext("2d");try{return n&&r&&r.putImageData(n.getImageData(0,0,e.width,e.height),0,0),t}catch(a){v("Failed to clone canvas",a)}return t}function Nt(e){return E(this,null,function*(){if(e.ownerDocument&&!e.currentSrc&&e.poster)return _(e.poster,e.ownerDocument);const t=e.cloneNode(!1);t.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc);const n=t.ownerDocument;if(n){let r=!0;if(yield $(t,{onError:()=>r=!1}),!r)return e.poster?_(e.poster,e.ownerDocument):t;t.currentTime=e.currentTime,yield new Promise(i=>{t.addEventListener("seeked",i,{once:!0})});const a=n.createElement("canvas");a.width=e.offsetWidth,a.height=e.offsetHeight;try{const i=a.getContext("2d");i&&i.drawImage(t,0,0,a.width,a.height)}catch(i){return v("Failed to clone video",i),e.poster?_(e.poster,e.ownerDocument):t}return Ee(a)}return t})}function It(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager"),t}function kt(e,t){return Ze(e)?Ee(e):at(e)?At(e,t):P(e)?It(e):X(e)?Nt(e):e.cloneNode(!1)}function Ce(e,t,n){return E(this,null,function*(){k(t)&&(tt(t)||nt(t))||n.filter&&!n.filter(t)||e.appendChild(yield J(t,n))})}function Te(e,t,n){return E(this,null,function*(){var a,i;const r=(i=k(e)?(a=e.shadowRoot)==null?void 0:a.firstChild:void 0)!=null?i:e.firstChild;for(let o=r;o;o=o.nextSibling)if(!Ke(o))if(k(o)&&ot(o)&&typeof o.assignedNodes=="function"){const s=o.assignedNodes();for(let c=0;c<s.length;c++)yield Ce(t,s[c],n)}else yield Ce(t,o,n)})}function xt(e,t){const{backgroundColor:n,width:r,height:a,style:i}=t,o=e.style;if(n&&o.setProperty("background-color",n,"important"),r&&o.setProperty("width",`${r}px`,"important"),a&&o.setProperty("height",`${a}px`,"important"),i)for(const s in i)o[s]=i[s]}const Rt=/^[\w-:]+$/;function J(e,t,n=!1){return E(this,null,function*(){var s,c,u,l;const{ownerDocument:r,ownerWindow:a,fontFamilies:i}=t;if(r&&Qe(e))return r.createTextNode(e.data);if(r&&a&&k(e)&&(re(e)||q(e))){const f=yield kt(e,t);if(t.isEnable("removeAbnormalAttributes")){const g=f.getAttributeNames();for(let y=g.length,b=0;b<y;b++){const w=g[b];Rt.test(w)||f.removeAttribute(w)}}const d=vt(e,f,n,t);n&&xt(f,t);let m=!1;if(t.isEnable("copyScrollbar")){const g=[(s=d.get("overflow-x"))==null?void 0:s[0],(c=d.get("overflow-y"))==null?void 0:c[1]];m=g.includes("scroll")||(g.includes("auto")||g.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}return Ct(e,f,m,t),Tt(e,f),(l=we((u=d.get("font-family"))==null?void 0:u[0]))==null||l.forEach(g=>i.add(g)),X(e)||(yield Te(e,f,t)),f}const o=e.cloneNode(!1);return yield Te(e,o,t),o})}function ve(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(t){}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[]}function Dt(e){const s=e,{url:t,timeout:n,responseType:r}=s,a=Oe(s,["url","timeout","responseType"]),i=new AbortController,o=n?setTimeout(()=>i.abort(),n):void 0;return fetch(t,R({signal:i.signal},a)).then(c=>{if(!c.ok)throw new Error("Failed fetch, not 2xx response",{cause:c});switch(r){case"dataUrl":return c.blob().then(ft);case"text":default:return c.text()}}).finally(()=>clearTimeout(o))}function V(e,t){const{url:n,requestType:r="text",responseType:a="text",imageDom:i}=t;let o=n;const{timeout:s,acceptOfImage:c,requests:u,fetch:{requestInit:l,bypassingCache:f,placeholderImage:d},workers:m}=e;r==="image"&&(z||ne)&&e.drawImageCount++;let g=u.get(n);if(!g){f&&f instanceof RegExp&&f.test(o)&&(o+=(/\?/.test(o)?"&":"?")+new Date().getTime());const y=R({url:o,timeout:s,responseType:a,headers:r==="image"?{accept:c}:void 0},l);g={type:r,resolve:void 0,reject:void 0,response:null},g.response=(!z&&n.startsWith("http")&&m.length?new Promise((b,w)=>{m[u.size&m.length-1].postMessage(R({rawUrl:n},y)),g.resolve=b,g.reject=w}):Dt(y)).catch(b=>{if(u.delete(n),r==="image"&&d)return v("Failed to fetch image base64, trying to use placeholder image",o),typeof d=="string"?d:d(i);throw b}),u.set(n,g)}return g.response}function Ae(e,t,n,r){return E(this,null,function*(){if(!Ne(e))return e;for(const[a,i]of Ft(e,t))try{const o=yield V(n,{url:i,requestType:r?"image":"text",responseType:"dataUrl"});e=e.replace(Ut(a),`$1${o}$3`)}catch(o){v("Failed to fetch css data url",a,o)}return e})}function Ne(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const Ie=/url\((['"]?)([^'"]+?)\1\)/g;function Ft(e,t){const n=[];return e.replace(Ie,(r,a,i)=>(n.push([i,ue(i,t)]),r)),n.filter(([r])=>!oe(r))}function Ut(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function _t(e,t){return E(this,null,function*(){const{ownerDocument:n,svgStyleElement:r,fontFamilies:a,fontCssTexts:i,tasks:o,font:s}=t;if(!(!n||!r||!a.size))if(s&&s.cssText){const c=xe(s.cssText,t);r.appendChild(n.createTextNode(`${c}
`))}else{const c=Array.from(n.styleSheets).filter(l=>{try{return"cssRules"in l&&!!l.cssRules.length}catch(f){return v(`Error while reading CSS rules from ${l.href}`,f),!1}});yield Promise.all(c.flatMap(l=>Array.from(l.cssRules).map((f,d)=>E(this,null,function*(){if(Ye(f)){let m=d+1;const g=f.href;let y="";try{y=yield V(t,{url:g,requestType:"text",responseType:"text"})}catch(w){v(`Error fetch remote css import from ${g}`,w)}const b=y.replace(Ie,(w,S,p)=>w.replace(p,ue(p,g)));for(const w of $t(b))try{l.insertRule(w,w.startsWith("@import")?m+=1:l.cssRules.length)}catch(S){v("Error inserting rule from remote css import",{rule:w,error:S})}}})))),c.flatMap(l=>Array.from(l.cssRules)).filter(l=>{var f;return Ge(l)&&Ne(l.style.getPropertyValue("src"))&&((f=we(l.style.getPropertyValue("font-family")))==null?void 0:f.some(d=>a.has(d)))}).forEach(l=>{const f=l,d=i.get(f.cssText);d?r.appendChild(n.createTextNode(`${d}
`)):o.push(Ae(f.cssText,f.parentStyleSheet?f.parentStyleSheet.href:null,t).then(m=>{m=xe(m,t),i.set(f.cssText,m),r.appendChild(n.createTextNode(`${m}
`))}))})}})}const Pt=/(\/\*[\s\S]*?\*\/)/gi,ke=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function $t(e){if(e==null)return[];const t=[];let n=e.replace(Pt,"");for(;;){const i=ke.exec(n);if(!i)break;t.push(i[0])}n=n.replace(ke,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,a=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let i=r.exec(n);if(i)a.lastIndex=r.lastIndex;else if(i=a.exec(n),i)r.lastIndex=a.lastIndex;else break;t.push(i[0])}return t}const Bt=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Lt=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function xe(e,t){const{font:n}=t,r=n?n==null?void 0:n.preferredFormat:void 0;return r?e.replace(Lt,a=>{for(;;){const[i,,o]=Bt.exec(a)||[];if(!o)return"";if(o===r)return`src: ${i};`}}):e}function Mt(e,t){if(P(e)){const n=e.currentSrc||e.src;if(!oe(n))return[V(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(e.srcset="",e.dataset.originalSrc=n,e.src=r||"")})];(z||ne)&&t.drawImageCount++}else if(q(e)&&!oe(e.href.baseVal)){const n=e.href.baseVal;return[V(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(e.dataset.originalSrc=n,e.href.baseVal=r||"")})]}return[]}const Ot=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function Wt(e,t){return Ot.map(n=>{const r=e.getPropertyValue(n);return r?((z||ne)&&t.drawImageCount++,Ae(r,null,t,!0).then(a=>{!a||r===a||e.setProperty(n,a,e.getPropertyPriority(n))})):null}).filter(Boolean)}function jt(e,t){var s;const{ownerDocument:n,svgDefsElement:r}=t,a=(s=e.getAttribute("href"))!=null?s:e.getAttribute("xlink:href");if(!a)return[];const[i,o]=a.split("#");if(o){const c=`#${o}`,u=n==null?void 0:n.querySelector(`svg ${c}`);if(i&&e.setAttribute("href",c),r!=null&&r.querySelector(c))return[];if(u)return[J(u,t).then(l=>{r!=null&&r.querySelector(c)||r==null||r.appendChild(l)})];if(i)return[V(t,{url:i,responseType:"text"}).then(l=>{r==null||r.insertAdjacentHTML("beforeend",l)})]}return[]}function Re(e,t){const{tasks:n}=t;k(e)&&((P(e)||ce(e))&&n.push(...Mt(e,t)),Je(e)&&n.push(...jt(e,t))),re(e)&&n.push(...Wt(e.style,t)),e.childNodes.forEach(r=>{Re(r,t)})}function De(e,t){return E(this,null,function*(){const n=yield x(e,t);if(k(n.node)&&q(n.node))return n.node;const{ownerDocument:r,log:a,tasks:i,svgStyleElement:o,svgDefsElement:s,svgStyles:c,font:u,progress:l,autoDestruct:f,onCloneNode:d,onEmbedNode:m,onCreateForeignObjectSvg:g}=n;a.time("clone node");const y=yield J(n.node,n,!0);if(o&&r){let N="";c.forEach((I,F)=>{N+=`${I.join(`,
`)} {
  ${F}
}
`}),o.appendChild(r.createTextNode(N))}a.timeEnd("clone node"),d==null||d(y),u!==!1&&k(y)&&(a.time("embed web font"),yield _t(y,n),a.timeEnd("embed web font")),a.time("embed node"),Re(y,n);const b=i.length;let w=0;const S=()=>E(this,null,function*(){for(;;){const N=i.pop();if(!N)break;try{yield N}catch(I){v("Failed to run task",I)}l==null||l(++w,b)}});l==null||l(w,b),yield Promise.all([...Array(4)].map(S)),a.timeEnd("embed node"),m==null||m(y);const p=qt(y,n);return s&&p.insertBefore(s,p.children[0]),o&&p.insertBefore(o,p.children[0]),f&&ve(n),g==null||g(p),p})}function qt(e,t){const{width:n,height:r}=t,a=fe(n,r,e.ownerDocument),i=a.ownerDocument.createElementNS(a.namespaceURI,"foreignObject");return i.setAttributeNS(null,"x","0%"),i.setAttributeNS(null,"y","0%"),i.setAttributeNS(null,"width","100%"),i.setAttributeNS(null,"height","100%"),i.append(e),a.appendChild(i),a}function K(e,t){return E(this,null,function*(){var o;const n=yield x(e,t),r=yield De(n),a=de(r,n.isEnable("removeControlCharacter"));n.autoDestruct||(n.svgStyleElement=ye(n.ownerDocument),n.svgDefsElement=(o=n.ownerDocument)==null?void 0:o.createElementNS(Y,"defs"),n.svgStyles.clear());const i=_(a,r.ownerDocument);return yield wt(i,n)})}function Vt(e,t){return E(this,null,function*(){const n=yield x(e,t),{log:r,type:a,quality:i,dpi:o}=n,s=yield K(n);r.time("canvas to blob");const c=yield lt(s,a,i);if(["image/png","image/jpeg"].includes(a)&&o){const u=yield dt(c.slice(0,33));let l=new Uint8Array(u);return a==="image/png"?l=ae(l,o):a==="image/jpeg"&&(l=C(l,o)),r.timeEnd("canvas to blob"),new Blob([l,c.slice(33)],{type:a})}return r.timeEnd("canvas to blob"),c})}function B(e,t){return E(this,null,function*(){const n=yield x(e,t),{log:r,quality:a,type:i,dpi:o}=n,s=yield K(n);r.time("canvas to data url");let c=s.toDataURL(i,a);if(["image/png","image/jpeg"].includes(i)&&o&&ie&&ze){const[u,l]=c.split(",");let f=0,d=!1;if(i==="image/png"){const p=Ve(l);p>=0?(f=Math.ceil((p+28)/3)*4,d=!0):f=33/3*4}else i==="image/jpeg"&&(f=18/3*4);const m=l.substring(0,f),g=l.substring(f),y=window.atob(m),b=new Uint8Array(y.length);for(let p=0;p<b.length;p++)b[p]=y.charCodeAt(p);const w=i==="image/png"?ae(b,o,d):C(b,o),S=window.btoa(String.fromCharCode(...w));c=[u,",",S,g].join("")}return r.timeEnd("canvas to data url"),c})}function Fe(e,t){return E(this,null,function*(){const n=yield x(e,t),{width:r,height:a,ownerDocument:i}=n,o=yield B(n),s=fe(r,a,i),c=s.ownerDocument.createElementNS(s.namespaceURI,"image");return c.setAttributeNS(null,"href",o),c.setAttributeNS(null,"height","100%"),c.setAttributeNS(null,"width","100%"),s.appendChild(c),de(s,n.isEnable("removeControlCharacter"))})}function Ht(e,t){return E(this,null,function*(){const n=yield x(e,t),{ownerDocument:r,width:a,height:i,scale:o,type:s}=n,c=s==="image/svg+xml"?yield Fe(n):yield B(n),u=_(c,r);return u.width=Math.floor(a*o),u.height=Math.floor(i*o),u.style.width=`${a}px`,u.style.height=`${i}px`,u})}function zt(e,t){return E(this,null,function*(){return B(yield x(e,L(R({},t),{type:"image/jpeg"})))})}function Xt(e,t){return E(this,null,function*(){const n=yield x(e,t),r=yield K(n);return r.getContext("2d").getImageData(0,0,r.width,r.height).data})}function Gt(e,t){return E(this,null,function*(){return B(yield x(e,L(R({},t),{type:"image/png"})))})}function Yt(e,t){return E(this,null,function*(){return B(yield x(e,L(R({},t),{type:"image/webp"})))})}h.createContext=pe,h.destroyContext=ve,h.domToBlob=Vt,h.domToCanvas=K,h.domToDataUrl=B,h.domToForeignObjectSvg=De,h.domToImage=Ht,h.domToJpeg=zt,h.domToPixel=Xt,h.domToPng=Gt,h.domToSvg=Fe,h.domToWebp=Yt,h.loadMedia=$,h.waitUntilLoad=ge,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
